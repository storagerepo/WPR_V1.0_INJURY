<link rel="stylesheet" href="resources/components/datetime/datetimepicker.css"></link>
<script src="resources/components/datetime/datetimepicker.js"></script>
<script src="resources/components/datetime/moment.js"></script>

<div class="row">
	<div class="col-lg-12">
		<div flash-message="2000" class="col-md-5 pull-right margin-top35"></div>
	 	<h2 class="page-header">Search Patients</h2>
	</div>
	<!-- /.col-lg-12 -->
</div>
<!-- /.row -->

<div class="row">
	<form name="patientSearchForm" novalidate>
    	<div class="col-md-12 no-padding">
        	<div class="col-md-3">
       			<div class="col-md-12"> <span class="redText">*</span> <label>County</label></div>
       			<div class="col-md-12"> 
       				<select class="form-control input-sm" ng-model="patient.countyId" required>
          				<option value="" ng-selected="true">--Select County--</option>
          				<option ng-repeat="county in countylist" value="{{county.countyId}}" ng-selected="{{county.countyName === patient.county}}">{{county.countyName}}</option>
     				</select>
       			</div>
        	</div>
          	<div class="col-md-3">
       		<div class="col-md-12"> <span class="redText">*</span> <label>Crash From Date</label></div>
       		<div class="col-md-12"> 
       			<div class="input-group">
					<input type="text" name="crashFromDate" id="CrashFromDate" ng-change="checkCustomDate(patient.numberOfDays)" class="form-control input-sm" ng-model="patient.crashFromDate" placeholder="Crash From Date" ng-required="!(patient.crashFromDate.length || patient.addedFromDate.length)"> 
					<span class="input-group-addon white-color-bg"> <span class="glyphicon glyphicon-calendar"></span></span>
				</div>
       		</div>
        </div>
        
        <div class="col-md-3">
       		<div class="col-md-12">  <label>Number of Days</label></div>
       		<div class="col-md-12"> 
         		<select class="form-control input-sm"  ng-model="patient.numberOfDays" name="numberOfDays" ng-change="checkCustomDate(patient.numberOfDays)">
                    <option value="1" ng-selected="true">1</option>
                    <option value="7">7</option>
                    <option value="15">15</option>	
                    <option value="30">30</option>
                    <option value="0">Custom</option>
                </select>
       		</div>
        </div>
         <div class="col-md-3">
       		<div class="col-md-12"><label>Crash To Date</label></div>
       		<div class="col-md-12"> 
        		<div class="input-group">
					<input type="text" name="crashToDate" id="CrashToDate" class="form-control input-sm" ng-model="patient.crashToDate" placeholder="Crash To Date"  ng-disabled="disableCustom"> 
					<span class="input-group-addon white-color-bg"> <span class="glyphicon glyphicon-calendar"></span></span>
				</div>
				<span style="color:red" ng-if="crashToRequired==true">Please Enter Crash To Date</span>
         	</div>
        </div>
	</div> 
	
	<div class="col-md-12"><br/></div>
	
	<div class="col-md-12 no-padding">
        <div class="col-md-3">
       			<div class="col-md-12"><label>Caller</label></div>
       			<div class="col-md-12"> 
       				<select class="form-control input-sm" ng-model="patient.callerId">
          				<option value="0" ng-selected="true">All</option>
          				<option ng-repeat="caller in callerList" value="{{caller.callerId}}" ng-selected="{{caller.callerId === patient.callerId}}">{{caller.firstName}} {{caller.lastName}}</option>
     				</select>
       			</div>
        	</div>
        	 <div class="col-md-3">
       			<div class="col-md-12"><label>tier</label></div>
       			<div class="col-md-12"> 
       				<select class="form-control input-sm" ng-model="patient.tier">
          				<option value="0" ng-selected="true">All</option>
          				<option value="1">Type 1</option>
          				<option value="2">Type 2</option>
          				<option value="3">Type 3</option>
     				</select>
       			</div>
        	</div>
        <div class="col-md-3">
        <div class="col-md-12"><label>&nbsp;</label></div>
			<div class="col-md-12">
        		<a href="" class="btn btn-sm btn-success" ng-class="{'button-disable':patientSearchForm.$invalid}"  ng-disabled='isClean() || patientSearchForm.$invalid' ng-click="searchPatients()">Search</a>
        		<a href="" class="btn btn-sm btn-danger" ng-click="resetSearchData()">Reset</a>
       		</div>
     	</div>
	</div>

	<div class="col-md-12">
		<div class="col-md-12 hr-tag-alter">
			<div  class="col-md-7 no-padding">
				<a href="" ng-disabled="isCleanCheckbox()" ng-click="assignCallerPopup()" class="btn btn-sm btn-success">Assign Caller</a>
				<a href="" ng-disabled="isCleanCheckbox()" ng-click="releaseCaller()" class="btn btn-sm btn-danger">Release From Caller</a>
				<a href="" ng-disabled="isCleanCheckbox()" ng-click="moveArchive()" class="btn btn-sm btn-warning">Move to Archive</a>
				<a href="" ng-disabled="isCleanCheckbox()" ng-click="releaseArchive()" class="btn btn-sm btn-primary">Release from Archive</a>
			</div>
			<div class="col-md-2"><div class="margin-top-5 text-right">Filter by</div></div>
			<div class="col-md-3 no-padding">
				<select class="form-control input-sm" ng-change="secoundarySearchPatient()" ng-model="patient.patientStatus">
					<option value="0" ng-selected="true">All</option>
		          	<option value="1">New</option>
		          	<option value="2">Active</option>
		          	<option value="3">Do not call</option>
		          	<option value="4">Not Injured</option>
		          	<option value="5">Voice Mail</option>
		          	<option value="6">Archive</option>
		          	<option value="7">Appointment Scheduled</option>
		     	</select>
			</div>
		</div>
	</div>
            
</form>                    
                <table class="table table-striped table-bordered">
                        <thead>
                            <tr>
                            	<th width="2%"><input ng-change="isChecked()" ng-model="isCheckedAllPatients" type="checkbox" id="checkAll"></th>
                                <th width="20%">Patient Name</th>
                                <th width="20%">Local Report Number</th>
                                <th width="18%">Phone Number</th>
                                <th width="15%">Caller Name</th>
                                <th width="12%">Crash Date</th>
                                <th width="8%">Actions</th>
                            </tr>
                            <tr>
                            	<th></th>
								<th>
								<div class="input-group">
  								<span class="input-group-addon search" id="basic-addon2"><i class="fa fa-search"></i></span>
								<input class="form-control input-sm" type="text" ng-model="patient.patientName" ng-change="secoundarySearchPatient()" placeholder="Patient Name"></div>
								</th>
								<th>
								<div class="input-group">
  								<span class="input-group-addon search" id="basic-addon2"><i class="fa fa-search"></i></span>
								<input class="form-control input-sm" type="text" ng-model="patient.localReportNumber" ng-change="secoundarySearchPatient()" placeholder="Local Report No"></div></th>
								
								<th>
								<div class="input-group">
  								<span class="input-group-addon search" id="basic-addon3"><i class="fa fa-search"></i></span>
								<input class="form-control input-sm" type="text" ng-model="patient.phoneNumber" ng-change="secoundarySearchPatient()" placeholder="Phone Number"></div></th>									
								<th>
								<!-- <div class="input-group">
  								<span class="input-group-addon search" id="basic-addon4"><i class="fa fa-search"></i></span>
								<input class="form-control" type="text"
									ng-model="search.crashDate" placeholder="Crash Date"></div> --></th>
								<th>
								<!-- <div class="input-group">
  								<span class="input-group-addon search" id="basic-addon5"><i class="fa fa-search"></i></span>
								<input class="form-control" type="text"
									ng-model="search.address" placeholder="Address"></div> --></th>
								<th></th>	
								
							</tr>
                        </thead>
                        <tbody>
                            <tr ng-show="patientSearchData.length>0"  dir-paginate="patient in patientSearchData|itemsPerPage:patient.itemsPerPage" current-page="setPage" total-items="totalRecords">
                                <td><input ng-change="isCheckedIndividual()" ng-model="patient.selected" type="checkbox"></td>
                                <td>{{patient.name}}</td>
                                <td>{{patient.localReportNumber}}</td>
                                <td>{{patient.phoneNumber}}</td>
                                <td><span ng-show="patient.callerFirstName==null && patient.callerLastName==null">N/A</span>{{patient.callerFirstName}} {{patient.callerLastName}}</td>
                                <td>{{patient.crashDate}}</td>
                                <td>
                                	<a href="{{patient.crashReportFileName}}" ng-cloak target="_blank" class="btn btn-xs btn-danger hint--top" data-hint="View Crash Report"><i
								class="fa fa-file-pdf-o"></i></a>
                                </td>
                            </tr>
                            <tr ng-show="patientSearchData.length==0">
                            <td colspan="7"><center><strong>No Records Found!!!</strong></center></td>
                            </tr>
                        </tbody>
                    </table>
                    <dir-pagination-controls max-size="5" on-page-change="searchPatientsFromPage(newPageNumber)" direction-links="true" boundary-links="true" >
    					</dir-pagination-controls>
</div>

<div class="modal fade" id="assignCallerModal" role="dialog">
    <div class="modal-dialog">    
      <!-- Modal content-->
      <div class="modal-content">
      <form name="myForm" novalidate>
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Assign Caller </h4>
        </div>
        <div class="modal-body">
        	<label>Choose Caller</label>
       			<select class="form-control" ng-model="myForm.callerId" required>
          			<option ng-repeat="caller in callerList" value="{{caller.callerId}}" ng-selected="{{caller.callerId === patient.callerId}}">{{caller.firstName}} {{caller.lastName}}</option>
     			</select>
        </div>
        <div class="modal-footer" >
         <button type="close" class="btn btn-danger" data-dismiss="modal">Cancel</button>
             <a href="" type="submit" class="btn btn-success"  data-dismiss="modal" ng-disabled='myForm.$invalid' ng-click="assignCaller()">Assign</a>
        </div>
        </form>
      </div>
      
    </div>
 </div>
 
<script>
	$(function(){
		$("html,body").scrollTop(0);
	});
	    					
	$('#CrashFromDate').datetimepicker({
		pickTime : false,
		format:'MM/DD/YYYY',
		maxDate : new Date()
	}).on('dp.change', function (selected) {
	    var minimumDate = new Date(selected.date.valueOf());
	    $('#CrashToDate').data("DateTimePicker").setMinDate(minimumDate);
	});

	$('#CrashToDate').datetimepicker({
    	pickTime : false,
		format:'MM/DD/YYYY',
		maxDate : new Date()
    });
</script>