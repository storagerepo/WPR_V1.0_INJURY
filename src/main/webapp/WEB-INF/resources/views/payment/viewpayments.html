<link rel="stylesheet" href="resources/components/datetime/datetimepicker.css"></link>
            <script src="resources/components/datetime/moment.js"></script>
             <script src="resources/components/datetime/datetimepicker.js"></script>
<div class="row">
	<div class="col-lg-12">
		<a ui-sref="dashboard.payment" class="btn-sm btn-primary pull-right margin-top-40"><i class="fa fa-arrow-circle-left fa-lg"></i> Back</a>
		<div flash-message="2000" class="col-md-5 pull-right margin-top35"></div>	
		<h2 class="page-header">Payments</h2>
	</div>
	<!-- /.col-lg-12 -->
</div>
<!-- /.row -->
<div class="row">
<div class="col-lg-12">
  <table class="table table-striped table-bordered">
                	<tr>
						<td class="col-md-3"><b>Product Name</b></td>
						<td class="col-md-3">{{customerDetails.projectName}}</td>
						<td class="col-md-3"><b>Product Id</b></td>
						<td class="col-md-3">{{customerDetails.projectId}}</td>
						
					</tr>
					<tr>
						<td class="col-md-3"><b>First Name</b></td>
						<td class="col-md-3">{{customerDetails.firstName}}</td>
						<td class="col-md-3"><b>Last Name</b></td>
						<td class="col-md-3">{{customerDetails.lastName}}</td>
						
					</tr>
					<tr>
						<td class="col-md-3"><b>Phone Number</b></td>
						<td class="col-md-3">{{customerDetails.phoneNumber}}</td>
						<td class="col-md-3"><b>Email ID</b></td>
						<td class="col-md-3">{{customerDetails.emailId}}</td>
					</tr>
</table>
 </div>
 <div class="col-lg-12 col-sm-12">
 <div class="col-md-4">
 <label class="text-muted-no-top">Subscriptions From Date :</label> 
 						<div class="input-group">
       							<input type="text" name="subscriptionStartDate" id="subscriptionStartDate"
							class="form-control" ng-model="billsSearchForm.subcriptionFromDate"
							placeholder="From Date" ng-change="checkSearchSubscriptionToDate()">
							<span class="input-group-addon white-color-bg"> <span
							class="glyphicon glyphicon-calendar"></span></span>
							</div>
							</div>
							 <div class="col-md-4">
							<label class="text-muted-no-top">Subscriptions To Date :</label> 
							 <div class="input-group">
       							<input type="text" name="subscriptionEndDate" id="subscriptionEndDate"
							class="form-control" ng-model="billsSearchForm.subscriptionToDate"
							placeholder="To Date">
							<span class="input-group-addon white-color-bg"> <span
							class="glyphicon glyphicon-calendar"></span></span>
							</div>
							<div class="error-message">
                                <div ng-show="subcriptionToRequired">
                                <span>Select subscription to date</span>
                                </div>
                            </div>
							</div>
							<div class="col-md-4">
							<label class="text-muted-no-top">Bill ID :</label>
							<input class="form-control" ng-model="billsSearchForm.billId" placeholder="Bill ID"/>
							</div>
							
 </div>
  <div class="col-lg-12">
 <div class="col-md-4">
							<label class="text-muted-no-top">Bill From Date :</label>
							<div class="input-group">
       							<input type="text" name="billFromDateTime" id="billFromDateTime"
							class="form-control" ng-model="billsSearchForm.billFromDate"
							placeholder="Bill From Date" ng-change="checkSearchBillToDate()">
							<span class="input-group-addon white-color-bg"> <span
							class="glyphicon glyphicon-calendar"></span></span>
							</div>
							</div>
							<div class="col-md-4">
							<label class="text-muted-no-top">Bill To Date :</label>
							<div class="input-group">
       							<input type="text" name="billToDateTime" id="billToDateTime"
							class="form-control" ng-model="billsSearchForm.billToDate"
							placeholder="Bill To Date">
							<span class="input-group-addon white-color-bg"> <span
							class="glyphicon glyphicon-calendar"></span></span>
							</div>
							<div class="error-message">
                                <div ng-show="billToRequired">
                                <span>Select bill to date</span>
                                </div>
                            </div>
							</div>
							 <div class="col-md-4 pull-right">
							 <label>&nbsp;</label><br/>
								<a href="" class="btn btn-success btn-sm" ng-click="searchBills()">Search</a>
								<a href="" class="btn btn-danger btn-sm" ng-click="resetSearch()">Reset</a>
							</div>
  </div>
    <div class="col-lg-12 col-sm-12 margin-top-10">
        <table class="table table-bordered" ng-init="selectedIndex=0">
            <thead>
                <tr>
               		<th width="13%">Bill ID</th>
                    <th width="18%">Bill Date</th>
                    <th width="13%">$ Total Amount</th>
                    <th width="15%">$ Adjust Amount</th>
                    <th width="15%">$ Due Amount</th>
                    <th width="15%">$ Pay Amount</th>
                    <th width="11%">Actions</th>
                </tr>
               
            </thead>
            <tbody>
            <tr class="infoBackground" ng-show="subscriptionsList.length>0"
					ng-repeat-start="subscriptions in subscriptionsList">
					<td colspan="7" ng-click="selectedIndex==$index?selectedIndex=-1:selectedIndex=$index"><span><b>Subscription Start Date: </b>{{subscriptions.startDateTime}}</span> &nbsp; | &nbsp;
					<span><b>Subscription End Date: </b>{{subscriptions.endDateTime}}</span>&nbsp; | &nbsp;
					<span><b>Maximum Amount: </b>{{subscriptions.subscriptionMaximumAmount}}</span>
					<span class="pull-left"><span class="patient-count-circle-primary"  data-placement="top"><i class="fa fa-plus" data-tooltip="Show Plan Changes" ng-hide="$index==selectedIndex"></i><i class="fa fa-minus" data-tooltip="Hide Plan Changes" ng-show="$index==selectedIndex"></i></span>&nbsp;&nbsp;</span>
					</td>
			</tr>
                <tr dir-paginate="bill in subscriptions.billListSearchForms|itemsPerPage:billsSearchForm.itemsPerPage" current-page="billsSearchForm.pageNumber" total-items="totalRecords" pagination-id="billListPageId">
                	<td><a href="" ng-click="viewBillDetails(bill.billId)">{{bill.billDisplayId}}</a></td>
                    <td>{{bill.billDate}}</td>
                    <td>{{bill.billAmount}}</td>
                    <td>{{bill.adjustAmount}}</td>
                    <td>{{bill.dueAmount}}</td>
                    <td>{{bill.payAmount}}</td>
                    <td>
                    	<a href="" ng-click="viewBillDetails(bill.billId)" data-tooltip="View Bill Details" data-placement="top" class="btn btn-xs btn-primary"><i class="fa fa-eye"></i></a>&nbsp;
                       <a href="" ng-click="getTransactionDetails(bill.billId)" ng-show='bill.paymentStatus==1' data-tooltip="View&nbsp;Transaction&nbsp;Details" data-placement="top" class="btn btn-xs btn-success"><i class="fa fa-eye"></i></a>&nbsp;
                       <span class="label label-success" ng-show='bill.paymentStatus==1'>Paid</span>
                       <span class="label label-danger" ng-show='bill.paymentStatus==0'>Due</span>
                       <!--  <a href="#/dashboard/customer-bill-edit/{{subscriptions.productId}}/{{subscriptions.customerId}}/{{bill.billId}}" ng-show="bill.paymentStatus==0" data-tooltip="Edit" data-placement="top" class="btn btn-xs btn-info"><i class="fa fa-pencil"></i></a>
                        <a href="" ng-show="bill.paymentStatus==0" ng-disabled="true" ng-click="doPaymentModal(bill.billId,subscriptions.customerId,bill.billDisplayId,bill.billDate,bill.payAmount)" data-tooltip="Do&nbsp;Payment" data-placement="top" class="btn btn-xs btn-danger"><i class="fa fa-money"></i></a>
                       <a href="" ng-show="bill.paymentStatus==1" data-tooltip="Paid" data-placement="top" class="btn btn-xs btn-success"><i class="fa fa-money"></i></a>
                       <a href="" ng-show="bill.paymentStatus==0" data-tooltip="Notify User" data-placement="top" ng-click="notifyUser(bill.billId)" class="btn btn-xs btn-warning"><i class="fa fa-bell"></i></a> -->
                    </td>
                </tr>
                 <tr style="background-color:#eee;" ng-show="$index==selectedIndex"><td colspan="7">
                	<p class="pull-left"><b>Subscription Plan Changes</b></p><span class="label label-totalAmount pull-right">Total Due: {{subscriptions.lastMonthDue}} USD</span>
                	<table class="table table-bordered table-stripped">
                	<thead>
                	<tr style="background-color:#fff;">
                		<th width="5%">S.No</th>
                		<th width="18%">Plan</th>
                		<th width="15%">Start Date Time</th>
                		<th width="15%">End Date Time</th>
                		<th width="15%">Status</th>
                		<th width="15%">Charge Amount($)</th>
                	</tr>
                	</thead>
                	<tbody>
                	<tr ng-repeat="subscriptionPlans in subscriptions.subscriptionPlansForms">
                		<td>{{$index+1}}</td>
                		<td>{{subscriptionPlans.planName}}<span class="badge badge-primary pull-right" ng-show="subscriptionPlans.isMain==1">M</span><span class="badge badge-success pull-right" ng-show="subscriptionPlans.isMain==2">N</span></td>
                		<td>{{subscriptionPlans.startDateTime}}</td>
                		<td>{{subscriptionPlans.endDateTime}}</td>
                		<td><span class="text-danger" ng-show="subscriptionPlans.isRemoved==1"><b>Removed</b></span><span class="text-primary" ng-show="subscriptionPlans.isRemoved==0"><b>Carry Forward</b></span></td>
                		<td>{{subscriptionPlans.billAmount}}</td>
                	</tr>
                	<tr ng-show="subscriptions.subscriptionPlansForms.length==0">
             		   <td colspan="7" align="center">No Changes Recorded!</td>
              		  </tr> 
                	</tbody>
                	</table>
                
                </td>
                </tr>
               <tr ng-repeat-end=""></tr>
                <tr ng-show="subscriptionsList.length==0">
                <td colspan="7" align="center">No Records Found</td>
                </tr> 
            </tbody>
        </table>
		<dir-pagination-controls ng-show="subscriptionsList.length>0" max-size="5" direction-links="true"
			boundary-links="true" pagination-id="billListPageId"> </dir-pagination-controls>
		<div class="col-md-3 pull-right no-padding margin-bottom-10">
			<label>Number of Records</label> <select class="form-control"
				ng-model="billsSearchForm.itemsPerPage" name="itemsPerPage" id="recordsPerPage" ng-change="secondarySearchBillsList();">
				<option value="10">Show 10 Per Page</option>
				<option value="25">Show 25 Per Page</option>
				<option value="50">Show 50 Per Page</option>
				<option value="100">Show 100 Per Page</option>
			</select>
		</div>
	</div>
	<!-- /.col-lg-12 -->
</div>
 <!-- View Payment Modal -->
 <div class="modal fade" id="viewPaymentModal" role="dialog">
    <div class="modal-dialog modal-lg">    
      <!-- Modal content-->
     <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Bill Details</h4>
            </div>
            <div class="modal-body modal-min-height-850">
            <table class="table table-striped table-bordered">
                       	<thead>
                       	</thead>
                       	<tbody>
                       	<tr><td><label class="text-muted-no-top">Name</label></td><td>{{customerDetails.firstName}} {{customerDetails.lastName}}</td><td><label class="text-muted-no-top">Bill ID </label></td><td> {{billDetails.billDisplayId}}</td></tr>
                       	<tr><td><label class="text-muted-no-top">Email ID</label></td><td>{{customerDetails.emailId}}</td><td><label class="text-muted-no-top">Bill Date </label></td><td>{{billDetails.billDateTime}}</td></tr>
                       	</tbody>
              </table>
         
                 <div class="col-lg-12">
                            <h4>Subscriptions</h4>
                            <hr/>
                       </div>
                        <div class="col-lg-12">
                       <table class="table table-striped table-bordered">
                       	<thead>
                       	</thead>
                       	<tbody>
                       	<tr><td><label class="text-muted-no-top">Product Name </label></td><td>{{customerDetails.projectName}}</td></tr>
                       	<tr><td><label class="text-muted-no-top">Product ID </label></td><td>{{customerDetails.projectId}}</td></tr>
                       	<tr ng-show="billDetails.subscriptionsForm.startDateTime==null"><td><label class="text-muted-no-top">Subscription Date </label></td><td> Cycle Start From Payment Date</td></tr>
                       	<tr ng-show="billDetails.subscriptionsForm.startDateTime!=null"><td><label class="text-muted-no-top"> Start Date :</label> {{billDetails.subscriptionsForm.startDateTime}}</td><td><label class="text-muted-no-top"> End Date :</label> {{billDetails.subscriptionsForm.endDateTime}}</td></tr>
                       	</tbody>
                       </table>
                       </div>
                     
                        <div class="col-lg-12 margin-top-25">
                           <h4>Pricing Plans</h4>
                           <hr/>
                        </div>
                        <div class="col-md-12">
                      	<p><b>Current Plans List</b></p>
                      	<hr/></div>
                        <div class="col-lg-12 margin-top-10" style="max-height:250px;overflow-y:scroll;">
                        <table class="table table-striped table-bordered">
                        <thead>
                        <tr><th width="10%">S.No</th><th width="45%">Plan Name</th><th width="25%">$ Amount</th></tr>
                        </thead>
                        <tbody>
                        <tr ng-repeat="billDetail in billDetails.billDetailsForms">
                        <td>{{$index+1}}</td>
                        <td>{{billDetail.plan}}</td>
                        <td>{{billDetail.amount}}</td>
                       </tr>
                        <tr ng-show="!billDetails.billDetailsForms.length"><td colspan="3" align="center"><b>No Plans Added</b></td></tr>
                        </tbody>
                        </table>
                        </div>
                        <div class="col-md-12 margin-top-25" ng-show="billDetails.lastBillDueDetailsForms.length>0">
                      	<p><b>Last Month Due Plans List</b></p>
                      	<hr/></div>
                      	 <div class="col-lg-12" style="max-height:250px;overflow-y:scroll;">
                        <table class="table table-striped table-bordered" ng-show="billDetails.lastBillDueDetailsForms.length>0">
                        <thead>
                        
                        <tr><th width="10%">S.No</th><th width="45%">Plan Name</th><th width="25%">$ Amount</th></tr>
                        </thead>
                        <tbody>
                        <tr ng-repeat="billDetailDue in billDetails.lastBillDueDetailsForms" >
                        <td>{{$index+1}}</td>
                        <td>{{billDetailDue.plan}}</td>
                        <td>{{billDetailDue.amount}}</td>
                       </tr>
                        <tr ng-show="!billDetails.billDetailsForms.length"><td colspan="3" align="center"><b>No Plans Added</b></td></tr>
                        </tbody>
                        </table>
                        </div>
                        <div class="col-lg-12">
                        <hr/>
                         <div class="col-lg-6"></div>
                        <div class="col-lg-2" align="right">
                        <label class="text-muted-no-top">Total $ :</label>
                        </div>
                        <div class="col-lg-1" align="left">{{billDetails.billAmount}}
                        </div>
                        </div>
                       	<div class="col-lg-12 margin-top-10">
                        <div class="col-lg-5"></div>
                        <div class="col-lg-3" align="right" style="width:25%">
                        <label class="text-muted-no-top">Adjust Amount $ :</label>
                        </div>
                        <div class="col-lg-2" align="left">
                        {{billDetails.adjustAmount}}
                        </div>
                        </div>
                         <div class="col-lg-12 margin-top-10">
                        <div class="col-lg-5"></div>
                        <div class="col-lg-3" align="right" style="width:25%">
                        <label class="text-muted-no-top">Due Amount $ :</label>
                        </div>
                         <div class="col-lg-2" align="left">
                        {{billDetails.dueAmount}}
                        </div>
                        </div>
                         <div class="col-lg-12 margin-top-10">
                        <div class="col-lg-6"></div>
                        <div class="col-lg-2" align="right">
                        <label class="text-muted-no-top">Pay Amount $ :</label>
                        </div>
                        <div class="col-lg-2" align="left">{{billDetails.payAmount}}
                        </div>
                        </div>
            </div>
            <div class="modal-footer" style="border:none;">
                <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
            </div>
        </div>
      
    </div>
 </div>
 <!-- View Transaction Details Modal -->
 <div class="modal fade" id="viewTransactionModal" role="dialog">
    <div class="modal-dialog">    
      <!-- Modal content-->
     <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal">&times;</button>
                <h4 class="modal-title">Transaction Details</h4>
            </div>
            <div class="modal-body">
            	<div class="col-md-12">
            	<table class="table table-bordered">
            	<tr><td width="50%">Transaction ID</td><td width="50%">{{transactionDetails.transId}}</td></tr>
            	<tr><td width="50%">Transaction Status</td><td width="50%"><span ng-show="transactionDetails.transactionStatus=='settledSuccessfully'" class="label label-success">Success</span></td></tr>
            	<tr><td colspan="2" style="background: #eee;">Settlement Information</td></tr>
            	<tr><td width="50%">Settlement Amount</td><td width="50%">USD {{transactionDetails.settleAmount}}</td></tr>
            	<tr><td width="50%">Settlement Date and Time</td><td width="50%">{{settlementDateTime}}</td></tr>
            	<tr><td width="50%">Batch ID</td><td width="50%">{{transactionDetails.batch.batchId}}</td></tr>
            	<tr><td colspan="2" style="background: #eee;">Payment Information</td></tr>
            	<tr><td width="50%">Card Number</td><td width="50%">{{transactionDetails.payment.creditCard.cardNumber}}</td></tr>
            	<tr><td width="50%">Total Amount</td><td width="50%">USD {{transactionDetails.settleAmount}}</td></tr>
            	<tr><td colspan="2" style="background: #eee;">Order Information</td></tr>
            	<tr><td width="50%">Invoice #</td><td width="50%">{{transactionDetails.order.invoiceNumber}}</td></tr>
            	</table>
            	</div>
            </div>
            <div class="modal-footer" style="border:none;">
                <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
            </div>
        </div>
      
    </div>
 </div>
 <script>
    $(document).ready(function(){
        $('[data-tooltip="tooltip"]').tooltip();
    });
    $('#subscriptionStartDate').datetimepicker({
		pickTime : true,
		format:'MM/DD/YYYY hh:mm:ss A',
		maxDate : new Date()
	}).on('dp.change', function (selected) {
	    var minimumDate = new Date(selected.date.valueOf());
	    $('#subscriptionEndDate').data("DateTimePicker").setMinDate(minimumDate);
	});
    $('#subscriptionEndDate').datetimepicker({
		pickTime : true,
		format:'MM/DD/YYYY hh:mm:ss A',
		minDate : new Date()
	});
    $('#billFromDateTime').datetimepicker({
		pickTime : true,
		format:'MM/DD/YYYY hh:mm:ss A',
		maxDate : new Date()
	}).on('dp.change', function (selected) {
	    var minimumDate = new Date(selected.date.valueOf());
	    $('#billToDateTime').data("DateTimePicker").setMinDate(minimumDate);
	});
    $('#billToDateTime').datetimepicker({
		pickTime : true,
		format:'MM/DD/YYYY hh:mm:ss A',
		minDate : new Date()
	});
</script>