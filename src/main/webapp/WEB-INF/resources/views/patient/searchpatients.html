<link rel="stylesheet" href="resources/components/datetime/datetimepicker.css"></link>
<script src="resources/components/datetime/datetimepicker.js"></script>
<script src="resources/components/datetime/moment.js"></script>
<div ng-cloak>
<div class="row">
	<div class="col-lg-12">
	<div class="form-group passenger-type pull-right margin-top35">
	<label>Report Type:</label>
			<div class="btn-group">
				<label class="btn btn-default" btn-radio="0"
					ng-model="patient.isRunnerReport"> Normal <span
					class="glyphicon glyphicon-file"></span>
				</label> <label class="btn btn-default" btn-radio="1"
					ng-model="patient.isRunnerReport"> Runner <span
					class="glyphicon glyphicon-file"></span>
				</label>
			</div>
		</div>
		<div flash-message="2000" class="col-md-5 pull-right"></div>
	 	<h2 class="page-header">Search Clients</h2>
	</div>
	<!-- /.col-lg-12 -->
</div>
<!-- /.row -->

<div class="row">
	<form name="patientSearchForm" novalidate ng-cloak>
    	<div class="col-md-12 no-padding">
        	<div class="col-md-3 no-padding">
       			<div class="col-md-12"><label>County</label><span class="error-class" ng-show="searchCountyMinError">&nbsp;&nbsp;Select at least one county</span></div>
       			<div class="col-md-12">
     				<div ng-dropdown-multiselect="" options="countylist" selected-model="patient.countyId" extra-settings="{idProp:'id',displayProp:'name',smartButtonMaxItems:'0',scrollable:true,scrollableHeight:'300px',buttonDefaultText:'Select Counties'}"></div>
       			</div>
        	</div>
          	<div class="col-md-3 no-padding">
       		<div class="col-md-12"><label>Crash From Date</label></div>
       		<div class="col-md-12"> 
       			<div class="input-group">
					<input type="text" name="crashFromDate" id="CrashFromDate" ng-change="checkCustomDate(patient.numberOfDays)" class="form-control" ng-model="patient.crashFromDate" placeholder="Crash From Date"> 
					<span class="input-group-addon white-color-bg"> <span class="glyphicon glyphicon-calendar"></span></span>
				</div>
       		</div>
        </div>
        
        <div class="col-md-3 no-padding">
       		<div class="col-md-12"><label>Number of Days</label></div>
       		<div class="col-md-12"> 
         		<select class="form-control"  ng-model="patient.numberOfDays" name="numberOfDays" ng-change="checkCustomDate(patient.numberOfDays)">
                    <option value="1" ng-selected="true">1</option>
                    <option value="7">7</option>
                    <option value="15">15</option>	
                    <option value="30">30</option>
                    <option value="0">Custom</option>
                </select>
       		</div>
        </div>
         <div class="col-md-3 no-padding">
       		<div class="col-md-12"><label>Crash To Date</label></div>
       		<div class="col-md-12"> 
        		<div class="input-group">
					<input type="text" name="crashToDate" id="CrashToDate" ng-change="crashToRequired=false" class="form-control" ng-model="patient.crashToDate" placeholder="Crash To Date"  ng-disabled="disableCustom" ng-required="{{patient.crashFromDate!=''}}"> 
					<span class="input-group-addon white-color-bg"> <span class="glyphicon glyphicon-calendar"></span></span>
				</div>
				<span style="color:red" ng-if="crashToRequired==true">Please Enter Crash To Date</span>
         	</div>
        </div>
	</div> 
	
	<div class="col-md-12"><br/></div>
	
	<div class="col-md-12 no-padding">
        <div class="col-md-3 no-padding">
       		<div class="col-md-12"><label>Added On From Date</label></div>
       		<div class="col-md-12"> 
       			<div class="input-group">
					<input type="text" name="addedOnFromDate" id="addedOnFromDate" ng-change="checkAddedOnToDate()" class="form-control" ng-model="patient.addedOnFromDate" placeholder="Added On From Date"> 
					<span class="input-group-addon white-color-bg"> <span class="glyphicon glyphicon-calendar"></span></span>
				</div>
       		</div>
       		</div>
       		<div class="col-md-3 no-padding">
       		<div class="col-md-12"><label>Added On To Date</label></div>
       		<div class="col-md-12"> 
        		<div class="input-group">
					<input type="text" name="addedOnToDate" id="addedOnToDate" ng-change="AddedOnToRequired=false" class="form-control" ng-disabled="isSelectedAddedFromDate" ng-model="patient.addedOnToDate" placeholder="Added On To Date" ng-required="{{patient.addedOnFromDate!=''}}"> 
					<span class="input-group-addon white-color-bg"> <span class="glyphicon glyphicon-calendar"></span></span>
				</div>
				<span style="color:red" ng-if="AddedOnToRequired==true">Please Enter Added On To Date</span>
         	</div>
        </div>
        
        <div class="col-md-3 no-padding">
       		<div class="col-md-12"><label>Local Report Number</label></div>
       		<div class="col-md-12"> 
        		<input type="text" name="localReportNumber" class="form-control" ng-model="patient.localReportNumber" placeholder="Local Report Number">
        		</div>
        </div>
        
					 
				
        <div class="col-md-3 no-padding">
        <div class="col-md-12"><label>&nbsp;</label></div>
			<div class="col-md-12">
        		<a class="btn btn-success" ng-class="{'button-disable':patientSearchForm.$invalid}"  ng-disabled='isClean() || patientSearchForm.$invalid || disableSearch' ng-click="searchPatients()">Search</a>
        		<a class="btn btn-danger" ng-click="resetSearchData()">Reset</a>
       		</div>
     	</div>
	</div>

	<div class="col-md-12"> <br/>  </div>
            
</form>                    
                    
       <div class="col-md-12">             
                    
                    
                    <table class="table table-bordered persist-area" ng-cloak>
                        <thead class="persist-header">
                            <tr>
                                <th width="20%">Client Name <span class="client-name">(Last, First, Middle)</span></th>
                                <th width="13%">Phone Number</th>
                                 <th width="13%">Age</th>
                                 <th width="6%">Unit No.</th>
                                 <th width="10%">County</th>
                                <th width="15%">Address</th>
                                <th width="6%">Actions</th>
                            </tr>
                            <tr>
								<th>
								<div class="input-group">
  								<span class="input-group-addon search" id="basic-addon2"><i class="fa fa-search"></i></span>
								<input class="form-control" type="text" ng-model="patient.patientName" ng-change="secoundarySearchPatient()" placeholder="Client Name"></div>
								</th>
								<th>
								<div class="input-group">
  								<span class="input-group-addon search" id="basic-addon3"><i class="fa fa-search"></i></span>
								<input class="form-control" type="text" ng-model="patient.phoneNumber" ng-change="secoundarySearchPatient()" placeholder="Phone No"></div></th>									
								<th>
								<div ng-dropdown-multiselect="" options="defaultAge" selected-model="patient.age" extra-settings="{smartButtonMaxItems:'0',scrollable:false,showCheckAll: false,showUncheckAll:false,disable:patient.isRunnerReport==1}"></div>
								</th>
								<th></th>	
								<th></th>
								<th></th>
								<th><a href="" ng-click="exportToExcel()" class="btn btn-sm btn-export" ng-disabled="exportButton || patientSearchData.length==0"><span ng-show="exportButton"><i class="glyphicon glyphicon-refresh spinning"></i>&nbsp;</span>{{exportButtonText}}</a></th>	
							</tr>
                        </thead>
                        <tbody>
                        <tr style="background-color: lightgreen;" ng-show="patientSearchData[0].archivedDate!=''"
						ng-repeat-start="resultMainData in patientSearchData">
						<td colspan="7"><span><b>Archive Date: </b>{{resultMainData.archivedDate}}</span></td>
						</tr>
                        	<tr class="group-header-back" ng-show="patientSearchData.length>0"  ng-repeat-start="resultData in resultMainData.searchResult">
                       			<td colspan="10" ><span><b>Local Report No:</b> {{resultData.localReportNumber}}</span>&nbsp;<span class="badge badge-warning hint--top" ng-show="resultData.isRunnerReport==2" data-hint="Runner Report">R</span><span class="pull-right no-padding"><span><b>Unit In Error: </b><span ng-show="resultData.unitInError!=''&&resultData.unitInError!=null">{{resultData.unitInError}}</span><span ng-show="resultData.unitInError==''||resultData.unitInError==null">-</span></span>&nbsp;&nbsp;|&nbsp;&nbsp;<span><b>Crash Date: </b>{{resultData.crashDate}}</span>&nbsp;&nbsp;|&nbsp;&nbsp;<span><b>Added Date: </b>{{resultData.addedDate}}</span>&nbsp;&nbsp;|&nbsp;&nbsp;<span><b>Clients Count:</b>&nbsp;&nbsp;<span class="hint--top patient-count-circle" data-hint="{{resultData.numberOfPatients}} Patients">{{resultData.numberOfPatients}}</span></span>&nbsp;</span></td>
                          	</tr>           	
                        
                            <tr dir-paginate="sAdminPatient in resultData.patientSearchLists|itemsPerPage:patient.itemsPerPage" current-page="patient.pageNumber" total-items="totalRecords" pagination-id="superAdminPatientPageId">
                                <!-- <td colspan="7">{{patient.localReportNumber}}</td>  -->
                                <td><span ng-if="(sAdminPatient.injuries==2 || sAdminPatient.injuries==3 || sAdminPatient.injuries==4) && (sAdminPatient.age>=18 || sAdminPatient.age==null)"><a href="" class="hint--top redText" ng-click="viewPatientModal(sAdminPatient.patientId)"  data-hint="View Client">{{sAdminPatient.name}}</a><span class="redText margin-left-10 hint--top" data-hint="Injuries : {{sAdminPatient.injuriesName}}"><i class="fa fa-arrow-up" ></i></span><span ng-show="sAdminPatient.seatingPosition=='1'" class="margin-left-10 hint--top driver-icon" data-hint="Driver">&nbsp;</span>&nbsp;<span class="badge hint--top" ng-show="sAdminPatient.isRunnerReport==2&&sAdminPatient.isRunnerReportPatient==1" data-hint="Runner Report">R</span><span class="badge badge-success hint--top" ng-show="sAdminPatient.isRunnerReport==2&&sAdminPatient.isRunnerReportPatient==2" data-hint="Updated Runner Report">R</span></span>
                               	 	<span ng-if="(sAdminPatient.injuries==2 || sAdminPatient.injuries==3 || sAdminPatient.injuries==4) && (sAdminPatient.age<18 && sAdminPatient.age!=null)"><a href="" class="hint--top warningText" ng-click="viewPatientModal(sAdminPatient.patientId)"  data-hint="View Client">{{sAdminPatient.name}}</a><span class="redText margin-left-10 hint--top" data-hint="Injuries : {{sAdminPatient.injuriesName}}"><i class="fa fa-arrow-up" ></i></span><span ng-show="sAdminPatient.seatingPosition=='1'" class="margin-left-10 hint--top driver-icon" data-hint="Driver">&nbsp;</span>&nbsp;<span class="badge hint--top" ng-show="sAdminPatient.isRunnerReport==2&&sAdminPatient.isRunnerReportPatient==1" data-hint="Runner Report">R</span><span class="badge badge-success hint--top" ng-show="sAdminPatient.isRunnerReport==2&&sAdminPatient.isRunnerReportPatient==2" data-hint="Updated Runner Report">R</span></span>
                               	 	<span ng-if="(sAdminPatient.injuries!=2 && sAdminPatient.injuries!=3 && sAdminPatient.injuries!=4) && (sAdminPatient.age>=18 || sAdminPatient.age==null)"><a href="" class="hint--top" ng-click="viewPatientModal(sAdminPatient.patientId)"  data-hint="View Client">{{sAdminPatient.name}}</a><span ng-show="sAdminPatient.seatingPosition=='1'" class="margin-left-10 hint--top driver-icon" data-hint="Driver">&nbsp;</span>&nbsp;<span class="badge hint--top" ng-show="sAdminPatient.isRunnerReport==2&&sAdminPatient.isRunnerReportPatient==1" data-hint="Runner Report">R</span><span class="badge badge-success hint--top" ng-show="sAdminPatient.isRunnerReport==2&&sAdminPatient.isRunnerReportPatient==2" data-hint="Updated Runner Report">R</span></span>
                               	 	<span ng-if="(sAdminPatient.injuries!=2 && sAdminPatient.injuries!=3 && sAdminPatient.injuries!=4) && (sAdminPatient.age<18 && sAdminPatient.age!=null)"><a href="" class="hint--top warningText" ng-click="viewPatientModal(sAdminPatient.patientId)"  data-hint="View Client">{{sAdminPatient.name}}</a><span ng-show="sAdminPatient.seatingPosition=='1'" class="margin-left-10 hint--top driver-icon" data-hint="Driver">&nbsp;</span>&nbsp;<span class="badge hint--top" ng-show="sAdminPatient.isRunnerReport==2&&sAdminPatient.isRunnerReportPatient==1" data-hint="Runner Report">R</span><span class="badge badge-success hint--top" ng-show="sAdminPatient.isRunnerReport==2&&sAdminPatient.isRunnerReportPatient==2" data-hint="Updated Runner Report">R</span></span>
                                </td>
                                <td title="Phone Number"><span ng-show="sAdminPatient.phoneNumber!=''&&sAdminPatient.phoneNumber!=null">{{sAdminPatient.phoneNumber}}</span><span ng-show="sAdminPatient.phoneNumber==''||sAdminPatient.phoneNumber==null">-</span></td>
                                <td title="Age"><span ng-show="sAdminPatient.age!=''&&sAdminPatient.age!=null">{{sAdminPatient.age}}</span><span ng-show="sAdminPatient.age==''||sAdminPatient.age==null">-</span></td>
                                <td title="Unit Number"><span ng-show="sAdminPatient.unitNumber!=''&&sAdminPatient.unitNumber!=null">{{sAdminPatient.unitNumber}}</span><span ng-show="sAdminPatient.unitNumber==''||sAdminPatient.unitNumber==null">-</span></td>
                                <td title="County">{{sAdminPatient.county}}</td>
                                <td title="Address"><span ng-show="sAdminPatient.address!=''&&sAdminPatient.address!=null">{{sAdminPatient.address}}</span><span ng-show="sAdminPatient.address==''||sAdminPatient.address==null">-</span></td>
                                <td>
                                	<a href="{{sAdminPatient.crashReportFileName}}" ng-cloak target="_blank" class="btn btn-xs btn-danger hint--top" data-hint="View Crash Report"><i
								class="fa fa-file-pdf-o"></i></a>
                                </td>
                            </tr>
                            <tr ng-repeat-end=""></tr>         
                            <tr ng-repeat-end=""></tr>                     
                            <tr ng-show="totalRecords==0">
                            <td colspan="7"><center><strong>No Records Found!!!</strong></center></td>
                            </tr>
                        </tbody>
                    </table>
                    <dir-pagination-controls  ng-show="totalRecords>0"  max-size="5"  direction-links="true" boundary-links="true" pagination-id="superAdminPatientPageId">
    					</dir-pagination-controls> 
    					<div class="col-md-3 pull-right no-padding">
<label>Number of Records</label>
	<select
		class="form-control" ng-model="patient.itemsPerPage" ng-change="itemsPerFilter()" name="noOfRows"
		id="noOfRows">
		<option value="10">Show 10 Per Page</option>
		<option value="25">Show 25 Per Page</option>
		<option value="50">Show 50 Per Page</option>
		<option value="100">Show 100 Per Page</option>
		<option value="250">Show 250 Per Page</option>
	</select> 
</div>
</div>
</div>


<div class="modal fade" id="myModal" tabindex="-1" role="dialog"
	aria-labelledby="myModalLabel">
	<div class="modal-dialog modal-lg" role="document">
		<div class="modal-content ">
			<div class="modal-header">
				<button type="button" class="close" data-dismiss="modal"
					aria-label="Close">
					<span aria-hidden="true">&times;</span>
				</button>
				<div class="form-group passenger-type pull-right">
				 <div class="btn-group" data-toggle="buttons">
                                        <label class="btn btn-default unit-toggle-label" ng-class="{active:patientDetails.seatingPosition!='1' || patientDetails.seatingPosition==null}" ng-disabled="patientDetails.seatingPosition=='1'">
                                            <input type="radio" name="unit" ng-model="patientDetails.seatingPosition"  id="option1" autocomplete="off"> Passenger
                                        </label>
                                        <label class="btn btn-default unit-toggle-label" ng-class="{active:patientDetails.seatingPosition=='1'}" ng-disabled="patientDetails.seatingPosition!='1' || patientDetails.seatingPosition==null">
                                            <input type="radio" name="unit" ng-model="patientDetails.seatingPosition" ng-selected="patientDetails.seatingPosition=='1'" id="option2" autocomplete="off"> &nbsp;&nbsp;Driver&nbsp;&nbsp;
                                        </label>
                                    </div>
				</div>
				<h4 class="modal-title" id="myModalLabel">Client Details</h4>
			</div>
			<div class="modal-body">
				<table class="table table-striped table-bordered">
					<tr>
						<td class="col-md-3"><b>Name</b></td>
						<td class="col-md-3">{{patientDetails.name}}</td>
						<td class="col-md-3"><b>Gender</b></td>
						<td class="col-md-3">{{patientDetails.gender}}</td>
						
					</tr>
					<tr>
						<td class="col-md-3"><b>Date Of Birth</b></td>
						<td class="col-md-3">{{patientDetails.dateOfBirth}}</td>
						<td class="col-md-3"><b>Age</b></td>
						<td class="col-md-3">{{patientDetails.age}}</td>
					</tr>
					<tr>
						<td class="col-md-3"><b>Phone Number</b></td>
						<td class="col-md-3">{{patientDetails.phoneNumber}}</td>
						<td class="col-md-3"><b>Address</b></td>
						<td class="col-md-3">{{patientDetails.address}}</td>
						
					</tr>
					<tr>
						<td class="col-md-3"><b>Unit Number</b></td>
						<td class="col-md-3">{{patientDetails.unitNumber}}</td>
						<td class="col-md-3"><b>Number of Units</b></td>
						<td class="col-md-3">{{patientDetails.numberOfUnits}}</td>
						
					</tr>
					<tr>
						<td class="col-md-3"><b>Units in Error</b></td>
						<td class="col-md-3">{{patientDetails.unitInError}}</td>
						<td class="col-md-3"><b>Local Report Number</b></td>
						<td class="col-md-3">{{patientDetails.localReportNumber}}</td>
						
						
					</tr>
					<tr>
						<td class="col-md-3"><b>Injuries</b></td>
						<td class="col-md-3">{{patientDetails.injuriesName}}
						</td>
						<td class="col-md-3"><b>Crash Severity</b></td>
						<td class="col-md-3">{{patientDetails.crashSeverityName}}
						</td>
					</tr>
					<tr>
					
						<td class="col-md-3"><b>Crash Date</b></td>
						<td class="col-md-3">{{patientDetails.crashDate}}</td>
							<td class="col-md-3"><b>Time of Crash</b></td>
						<td class="col-md-3">{{patientDetails.timeOfCrash}}</td>
						
					</tr>
					<tr>
						<td class="col-md-3"><b>EMS Agency</b></td>
						<td class="col-md-3">{{patientDetails.emsAgency}}</td>
						<td class="col-md-3"><b>Report Agency Name</b></td>
						<td class="col-md-3">{{patientDetails.reportingAgencyName}}</td>
					</tr>
					
					<tr>
						<td class="col-md-3"><b>County</b></td>
						<td class="col-md-3">{{patientDetails.county}}</td>
						<td class="col-md-3"><b>City Village Township</b></td>
						<td class="col-md-3">{{patientDetails.cityVillageTownship}}</td>
					</tr>
					<tr>
					<td class="col-md-3"><b>Medical Facility</b></td>
						<td class="col-md-3">{{patientDetails.medicalFacility}}</td>
						<td colspan="2"></td>
					</tr>
					<tr>
						<td class="col-md-3"><b>At Fault INS. Company</b></td>
						<td class="col-md-3">{{patientDetails.atFaultInsuranceCompany}}</td>
						<td class="col-md-3"><b>At Fault Policy Number</b></td>
						<td class="col-md-3">{{patientDetails.atFaultPolicyNumber}}</td>
					</tr>
					<tr>
						<td class="col-md-3"><b>Victim INS. Company</b></td>
						<td class="col-md-3">{{patientDetails.victimInsuranceCompany}}</td>
						<td class="col-md-3"><b>Victim Policy Number</b></td>
						<td class="col-md-3">{{patientDetails.victimPolicyNumber}}</td>
					</tr>
				</table>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
			</div>
		</div>
	</div>
</div>
<!-- Export Excel Alert Modal  -->
 <div class="modal fade" id="exportAlertModal" role="dialog" data-backdrop="static" 
   data-keyboard="false" >
    <div class="modal-dialog">    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Alert</h4>
        </div>
        <div class="modal-body">
        	<span style="color:red;">Please do filter by Added on From & To date. <br/>System recommends to download 3 months of data.</span>
        </div>
        <div class="modal-footer" >
         	<button type="close" class="btn btn-danger" data-dismiss="modal">OK</button>
        </div>
      </div>
      
    </div>
 </div>			
<script>
	$(function(){
		$("html,body").scrollTop(0);
	});
	    					
	$('#CrashFromDate').datetimepicker({
		pickTime : false,
		format:'MM/DD/YYYY',
		maxDate : new Date()
	}).on('dp.change', function (selected) {
	    var minimumDate = new Date(selected.date.valueOf());
	    $('#CrashToDate').data("DateTimePicker").setMinDate(minimumDate);
	});

	$('#CrashToDate').datetimepicker({
    	pickTime : false,
		format:'MM/DD/YYYY',
		maxDate : new Date()
    });

	$('#addedOnFromDate').datetimepicker({
		pickTime : false,
		format:'MM/DD/YYYY',
		maxDate : new Date()
	}).on('dp.change', function (selected) {
	    var minimumDate = new Date(selected.date.valueOf());
	    $('#addedOnToDate').data("DateTimePicker").setMinDate(minimumDate);
	});

	$('#addedOnToDate').datetimepicker({
    	pickTime : false,
		format:'MM/DD/YYYY',
		maxDate : new Date()
    });
	
</script>

<script src="resources/js/fixed-header.js">  </script>